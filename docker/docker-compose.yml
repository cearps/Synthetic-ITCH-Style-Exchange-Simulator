version: "3.8"

services:
  build:
    build:
      context: ..
      dockerfile: docker/Dockerfile.build
    volumes:
      - output:/app/output
    working_dir: /app

  test:
    build:
      context: ..
      dockerfile: docker/Dockerfile.test
    working_dir: /app
    command: ["/app/build/tests", "--gtest_color=yes"]

  simulator:
    build:
      context: ..
      dockerfile: docker/Dockerfile.build
    volumes:
      - output:/app/output
    working_dir: /app
    command: ["/app/build/qrsdp_run", "--seed", "42", "--days", "5", "--output", "/app/output/run_42"]

  notebooks:
    build:
      context: ..
      dockerfile: docker/Dockerfile.notebooks
    volumes:
      - output:/app/output
    ports:
      - "8888:8888"

volumes:
  output:
